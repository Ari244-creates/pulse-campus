<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Campus | PulseCampus + ReSourceX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #8b5cf6;
            --secondary: #06b6d4;
            --bg-dark: #0f172a;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: white;
            overflow-x: hidden;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            border-color: rgba(139, 92, 246, 0.4);
            transform: translateY(-2px);
        }

        .heatmap-cell {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .heatmap-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        #neuralCanvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
            opacity: 0.6;
        }

        .progress-circle {
            transition: stroke-dashoffset 1s ease-out;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .toast {
            animation: slideIn 0.4s ease-out forwards;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .sidebar {
            width: 80px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 2rem;
            z-index: 100;
        }

        .sidebar-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            color: #64748b;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .sidebar-icon.active {
            background: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.3);
        }

        .layer-badge {
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.1em;
            padding: 2px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            background: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
            margin-left: 8px;
        }

        /* Tooltip System */
        .sidebar-icon {
            position: relative;
        }

        .sidebar-icon::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 100%;
            margin-left: 12px;
            padding: 6px 12px;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: white;
            font-size: 10px;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            transform: translateX(-10px);
            z-index: 1000;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .sidebar-icon:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }

        .pipeline-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .pipeline-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
        }

        .priority-box {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            flex: 1;
        }

        /* School Toggle */
        .school-toggle {
            display: flex;
            background: rgba(30, 41, 59, 0.8);
            padding: 4px;
            border-radius: 8px;
            gap: 4px;
        }

        .school-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            color: #64748b;
        }

        .school-btn.active {
            background: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
        }

        /* Shuttle Animation */
        .shuttle-path {
            width: 100%;
            height: 2px;
            background: rgba(255, 255, 255, 0.05);
            position: relative;
            margin: 20px 0;
        }

        .shuttle-dot {
            width: 8px;
            height: 8px;
            background: #06b6d4;
            border-radius: 50%;
            position: absolute;
            top: -3px;
            box-shadow: 0 0 10px #06b6d4;
            animation: moveShuttle 10s linear infinite;
        }

        @keyframes moveShuttle {
            0% {
                left: 0%;
            }

            100% {
                left: 100%;
            }
        }
    </style>
</head>

<body class="min-h-screen">
    <canvas id="neuralCanvas"></canvas>

    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <!-- Brand Logo -->
        <div class="mb-8 p-4">
            <div
                class="w-10 h-10 rounded-lg bg-gradient-to-br from-violet-600 to-cyan-600 flex items-center justify-center font-bold text-white shadow-lg shadow-violet-500/20">
                P</div>
        </div>

        <!-- Core Navigation -->
        <div class="sidebar-icon active" data-tooltip="Campus Command Center">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
        </div>
        <div class="sidebar-icon" data-tooltip="Classrooms & Labs" onclick="scrollToSection('academic')">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M12 14l9-5-9-5-9 5 9 5z" />
                <path
                    d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222" />
            </svg>
        </div>
        <div class="sidebar-icon" data-tooltip="Hostels & Mess" onclick="scrollToSection('hostel')">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
        </div>
        <div class="sidebar-icon" data-tooltip="Exam & Timetable">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
        </div>
        <div class="sidebar-icon" data-tooltip="Transport & Mobility" onclick="scrollToSection('transport')">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 20l-5.447-2.724A2 2 0 013 15.488V5.08A2 2 0 014.553 3.2L10 6l5.447-2.724A2 2 0 0118 5.08v10.408a2 2 0 01-1.553 1.88L11 21V6z" />
            </svg>
        </div>
        <div class="sidebar-icon" data-tooltip="Sustainability" onclick="scrollToSection('sustainability')">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
        </div>
        <div class="sidebar-icon" data-tooltip="Security & Alerts" onclick="scrollToSection('security')">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M20.618 5.984A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016zM12 9v2m0 4h.01" />
            </svg>
        </div>

        <!-- Utility Section -->
        <div class="mt-auto pb-4 space-y-2">
            <div class="sidebar-icon" data-tooltip="Admin Profile">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
            </div>
            <div class="sidebar-icon" data-tooltip="System Logs">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
            </div>
            <div class="sidebar-icon" data-tooltip="Settings" onclick="openSettings()">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                </svg>
            </div>
            <div class="sidebar-icon border-t border-white/5 pt-4 !mb-0" data-tooltip="Secure Logout"
                onclick="logout()">
                <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
            </div>
        </div>
    </nav>

    <div class="pl-20"> <!-- Main content offset for sidebar -->
        <!-- Header -->
        <header class="p-8 flex justify-between items-start border-b border-white/5 backdrop-blur-md sticky top-0 z-50">
            <div class="flex items-center gap-4">
                <div
                    class="w-12 h-12 rounded-xl bg-gradient-to-br from-violet-600 to-cyan-600 flex items-center justify-center font-bold text-xl shadow-lg shadow-violet-500/20">
                    P</div>
                <div>
                    <h1
                        class="text-3xl font-extrabold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">
                        Pulse Campus <span class="text-violet-500 font-light ml-1">Command Center</span>
                    </h1>
                    <p class="mt-1 text-xs mono text-gray-500 uppercase tracking-[0.2em]">Amaravati, Andhra Pradesh
                        &bull; AY 2025-26 &bull; Session: Autumn</p>
                </div>
            </div>
            <div class="flex items-center gap-6">
                <!-- System Status -->
                <div class="flex items-center gap-4 mr-4">
                    <div class="text-right">
                        <div class="text-[10px] text-gray-500 uppercase font-bold tracking-widest">Campus Status</div>
                        <div class="flex items-center gap-2 justify-end">
                            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                            <span class="text-xs font-bold text-green-400 uppercase">Operational</span>
                        </div>
                    </div>
                </div>

                <!-- Alert Badge -->
                <div class="glass-card px-4 py-3 flex items-center gap-3 border-orange-500/30 bg-orange-500/5">
                    <div class="w-8 h-8 rounded-full bg-orange-500/20 flex items-center justify-center">
                        <svg class="w-4 h-4 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div>
                        <div class="text-[10px] uppercase font-bold text-orange-400">Live Alert</div>
                        <div class="text-xs font-semibold text-gray-200">Engineering Block Mid-Sem peak usage</div>
                    </div>
                </div>

                <div class="hidden md:flex flex-col items-end">
                    <div id="currentTime" class="text-2xl font-bold mono">00:00</div>
                    <div class="text-[10px] text-gray-500 uppercase tracking-tighter">Real-time Telemetry</div>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">

            <!-- Top Row: PulseCampus & Future Load Forecast -->
            <div class="lg:col-span-8 space-y-6">

                <!-- Heatmap View -->
                <div class="glass-card p-6">
                    <div class="flex justify-between items-start mb-8">
                        <div class="flex items-center">
                            <div class="w-2 h-2 rounded-full bg-violet-500 mr-3"></div>
                            <h2 class="text-xl font-bold">Academic Infrastructure</h2>
                            <span class="layer-badge">Layer 1</span>
                        </div>
                        <div class="flex flex-col items-end gap-3">
                            <div class="school-toggle">
                                <div class="school-btn active" onclick="switchSchool('SEAS')">SEAS</div>
                                <div class="school-btn" onclick="switchSchool('SLASS')">SLASS</div>
                                <div class="school-btn" onclick="switchSchool('SAMS')">SAMS</div>
                            </div>
                            <p class="text-[10px] text-gray-400 uppercase tracking-wider">Predictive Occupancy Mapping
                            </p>
                        </div>
                    </div>

                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-sm font-semibold text-gray-300">Campus Occupancy Heatmap</h3>
                        <div class="flex gap-4">
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-3 rounded bg-green-500"></div>
                                <span class="text-[10px] text-gray-400 font-bold uppercase">0-30%</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-3 rounded bg-yellow-500"></div>
                                <span class="text-[10px] text-gray-400 font-bold uppercase">31-70%</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-3 rounded bg-orange-500"></div>
                                <span class="text-[10px] text-gray-400 font-bold uppercase">71-90%</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-4 h-3 rounded bg-red-500"></div>
                                <span class="text-[10px] text-gray-400 font-bold uppercase">91-100%</span>
                            </div>
                        </div>
                    </div>

                    <div id="heatmapGrid" class="grid grid-cols-3 md:grid-cols-6 lg:grid-cols-8 gap-4">
                        <!-- Dynamic Grid Cells -->
                    </div>
                </div>

            </div>

            <!-- Top Row Right Column: Future Load Forecast -->
            <div class="lg:col-span-4 space-y-6">
                <!-- Academic Quick Stats -->
                <div class="grid grid-cols-2 gap-4 h-full">
                    <div class="glass-card p-4 flex flex-col justify-center border-l-2 border-violet-500">
                        <div class="text-[8px] text-gray-400 uppercase font-bold tracking-widest mb-1">Active Blocks
                        </div>
                        <div id="activeZones" class="text-2xl font-bold">04</div>
                        <div class="text-[8px] text-violet-400 mt-1">Tier-1 Connectivity</div>
                    </div>
                    <div class="glass-card p-4 flex flex-col justify-center border-l-2 border-cyan-500">
                        <div class="text-[8px] text-gray-400 uppercase font-bold tracking-widest mb-1">Student Density
                        </div>
                        <div class="text-2xl font-bold">9,240</div>
                        <div class="text-[8px] text-cyan-400 mt-1">Across 4 Schools</div>
                    </div>

                    <div class="col-span-2 glass-card p-6 flex flex-col justify-between">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-bold">Future Load</h2>
                            <span id="forecastStatus"
                                class="text-[9px] font-bold text-orange-400 mono px-2 py-0.5 bg-orange-400/10 rounded">WARNING</span>
                        </div>
                        <div class="flex-1 flex flex-col items-center justify-center py-4">
                            <div class="relative w-36 h-36">
                                <svg class="w-full h-full transform -rotate-90">
                                    <circle cx="72" cy="72" r="64" stroke="rgba(255,255,255,0.05)" stroke-width="8"
                                        fill="none" />
                                    <circle id="predictiveCircle" class="progress-circle" cx="72" cy="72" r="64"
                                        stroke="url(#violetGradient)" stroke-width="8" fill="none"
                                        stroke-dasharray="402.12" stroke-dashoffset="402.12" stroke-linecap="round" />
                                </svg>
                                <div class="absolute inset-0 flex flex-col items-center justify-center">
                                    <span id="predictiveLoad" class="text-4xl font-bold">0</span>
                                    <span class="text-[8px] text-gray-400 font-bold uppercase mt-1">% Load</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-[10px]">
                            <span class="text-gray-500 uppercase font-bold">Next Peak Predicted</span>
                            <span id="peakTime" class="mono text-cyan-400 font-bold">--:--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Second Row Left Column: Campus Operations Hub -->
            <div class="lg:col-span-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Hostel & Residential Analytics -->
                <div id="hostel" class="glass-card p-6 flex flex-col">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-2 h-2 rounded-full bg-cyan-500 mr-2"></div>
                            <h2 class="text-lg font-bold">Residential Hub</h2>
                        </div>
                        <span class="text-[10px] text-gray-500 uppercase mono">BH-1 to BH-5 & GH</span>
                    </div>

                    <div class="space-y-6 flex-1">
                        <div>
                            <div class="flex justify-between text-[10px] uppercase font-bold text-gray-400 mb-2">
                                <span>Mess Crowd Index</span>
                                <span class="text-orange-400">Lunch Peak In 12m</span>
                            </div>
                            <div class="h-2 w-full bg-white/5 rounded-full overflow-hidden">
                                <div id="messCrowdBar"
                                    class="h-full bg-gradient-to-r from-cyan-500 to-orange-500 shadow-[0_0_10px_rgba(6,182,212,0.3)] transition-all duration-1000"
                                    style="width: 78%"></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-white/5 p-3 rounded-lg border border-white/5">
                                <div class="text-[8px] text-gray-500 uppercase mb-1">Water Reserve</div>
                                <div id="waterReserve" class="text-xl font-bold mono">88k <span
                                        class="text-[10px] font-normal text-gray-500">L</span></div>
                            </div>
                            <div class="bg-white/5 p-3 rounded-lg border border-white/5">
                                <div class="text-[8px] text-gray-500 uppercase mb-1">Energy Saving</div>
                                <div id="energySaving" class="text-xl font-bold mono text-emerald-400">+12%</div>
                            </div>
                        </div>

                        <div
                            class="flex items-center justify-between p-3 bg-cyan-500/5 border border-cyan-500/20 rounded-lg">
                            <div class="text-xs font-semibold">Night-time Security</div>
                            <div class="text-[10px] mono text-cyan-400 px-2 py-1 bg-cyan-400/10 rounded">OPTIMAL</div>
                        </div>
                    </div>
                </div>

                <!-- Transport & Mobility -->
                <div id="transport" class="glass-card p-6 flex flex-col">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-2 h-2 rounded-full bg-blue-500 mr-2"></div>
                            <h2 class="text-lg font-bold">Mobility Pulse</h2>
                        </div>
                        <span class="text-[10px] text-blue-400 animate-pulse">LIVE</span>
                    </div>

                    <div class="space-y-4 flex-1">
                        <div class="p-4 bg-white/5 rounded-xl border border-white/5">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Pulse
                                    Shuttle
                                    Status</span>
                                <span class="text-[9px] mono text-gray-500">Near Gate 2</span>
                            </div>
                            <div class="shuttle-path">
                                <div class="shuttle-dot"></div>
                            </div>
                            <div class="text-center text-xs text-gray-300 mt-2">Arriving in <span id="shuttleETA"
                                    class="text-blue-400 font-bold">04:20</span></div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="flex justify-between items-center bg-white/5 p-3 rounded-lg">
                                <div class="text-[8px] text-gray-400 uppercase font-bold">Power Draw</div>
                                <div class="text-lg font-bold mono text-cyan-400"><span id="powerDraw">420</span> <span
                                        class="text-[10px] text-gray-500 font-normal">kWh</span></div>
                            </div>
                            <div class="text-center">
                                <div class="text-[8px] text-gray-500 uppercase mb-1">Visitor Spots</div>
                                <div class="text-lg font-bold text-emerald-400">12 <span
                                        class="text-[10px] text-gray-500">Left</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feedback Loop Column -->
            <div class="lg:col-span-4 space-y-6">
                <!-- Sustainability & Energy -->
                <div id="sustainability"
                    class="glass-card p-6 bg-gradient-to-br from-emerald-900/20 to-cyan-900/20 border-emerald-500/20">
                    <div class="flex items-center mb-6">
                        <div class="w-2 h-2 rounded-full bg-emerald-400 mr-2"></div>
                        <h2 class="text-lg font-bold">Sustainability Panel</h2>
                    </div>

                    <div class="space-y-4">
                        <div class="flex justify-between items-end">
                            <div>
                                <div class="text-[8px] text-gray-400 uppercase font-bold tracking-widest">Solar Energy
                                    Contribution</div>
                                <div class="text-2xl font-bold mono text-emerald-400"><span
                                        id="solarContribution">34.2</span> <span class="text-xs font-normal">kW</span>
                                </div>
                            </div>
                            <div class="text-right text-[10px] text-emerald-400 font-bold">+5% Today</div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 border-t border-white/5 pt-4">
                            <div>
                                <div class="text-[8px] text-gray-500 uppercase">Power Draw</div>
                                <div class="text-sm font-bold mono">420 kWh</div>
                            </div>
                            <div>
                                <div class="text-[8px] text-gray-500 uppercase">Water Reserve</div>
                                <div class="text-sm font-bold mono">88% Capacity</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Intelligence & Action Hub (Re-integrated ReSourceX Action Feed) -->
                <div class="glass-card p-6 flex flex-col h-[320px]">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-2 h-2 rounded-full bg-violet-400 mr-2"></div>
                            <h2 class="text-lg font-bold text-violet-400">Pulse Intel Engine</h2>
                        </div>
                    </div>
                    <div id="actionFeed" class="space-y-4 overflow-y-auto flex-1 pr-2 custom-scrollbar">
                        <!-- Actions injected here -->
                    </div>
                    <div class="mt-4 pt-4 border-t border-white/5">
                        <div class="flex items-center justify-between">
                            <span class="text-[8px] text-gray-500 uppercase font-bold">Priority Hierarchy</span>
                            <div class="flex gap-1">
                                <span
                                    class="px-2 py-0.5 bg-red-500/20 text-red-500 rounded text-[8px] font-bold">EXAM</span>
                                <span
                                    class="px-2 py-0.5 bg-yellow-500/10 text-yellow-500 rounded text-[8px] font-bold">CLASS</span>
                                <span
                                    class="px-2 py-0.5 bg-blue-500/10 text-blue-500 rounded text-[8px] font-bold">CLUB</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security & Emergency -->
                <div id="security" class="glass-card p-6 border-red-500/10 bg-red-500/5">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-2 h-2 rounded-full bg-red-500 mr-2"></div>
                            <h2 class="text-lg font-bold">Security & Alerts</h2>
                        </div>
                        <div class="text-[10px] text-red-400 font-bold">READY</div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-400">Surveillance Status</span>
                            <span class="text-emerald-400 font-bold">ACTIVE</span>
                        </div>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-400">Emergency Protocol</span>
                            <span class="text-emerald-400 font-bold">STANDBY</span>
                        </div>
                    </div>
                </div>
            </div>
    </div>

    <!-- Intelligence Pipeline Footer -->
    <div class="lg:col-span-12 py-12">
        <div class="flex flex-col items-center">
            <h4 class="text-sm font-bold text-gray-500 uppercase tracking-[0.3em] mb-8 text-center leading-loose">
                The Intelligence Pipeline</h4>
            <div class="flex items-center justify-center gap-12 md:gap-24 w-full max-w-4xl">
                <div class="pipeline-node">
                    <div class="pipeline-icon">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-bold text-violet-400 uppercase tracking-widest">Sense
                        </div>
                        <div class="text-[8px] text-gray-500 mt-1 uppercase">IoT: Acoustic, LDR, PIR
                        </div>
                    </div>
                </div>

                <div
                    class="flex-1 h-px bg-gradient-to-r from-violet-500/20 to-cyan-500/20 hidden md:block border-t border-dashed border-gray-700">
                </div>

                <div class="pipeline-node">
                    <div class="pipeline-icon">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-bold text-cyan-400 uppercase tracking-widest">Predict
                        </div>
                        <div class="text-[8px] text-gray-500 mt-1 uppercase">Model: Pulse-Load-V3</div>
                    </div>
                </div>

                <div
                    class="flex-1 h-px bg-gradient-to-r from-cyan-500/20 to-emerald-500/20 hidden md:block border-t border-dashed border-gray-700">
                </div>

                <div class="pipeline-node">
                    <div class="pipeline-icon">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-bold text-violet-300 uppercase tracking-widest">Decide
                        </div>
                        <div class="text-[8px] text-gray-500 mt-1 uppercase">Policy: Resource Max</div>
                    </div>
                </div>

                <div
                    class="flex-1 h-px bg-gradient-to-r from-emerald-500/20 to-cyan-500/20 hidden md:block border-t border-dashed border-gray-700">
                </div>

                <div class="pipeline-node">
                    <div class="pipeline-icon">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-bold text-emerald-400 uppercase tracking-widest">Act
                        </div>
                        <div class="text-[8px] text-gray-500 mt-1 uppercase">Edge Adjustment</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </main>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="fixed bottom-6 right-6 z-[100] space-y-3 pointer-events-none"></div>

    <script>
        // API Base URL
        const API_BASE = 'http://localhost:5000/api';

        // Neural Network Background
        const canvas = document.getElementById('neuralCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const nodes = [];
        const nodeCount = 50;

        for (let i = 0; i < nodeCount; i++) {
            nodes.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                vx: (Math.random() - 0.5) * 0.5,
                vy: (Math.random() - 0.5) * 0.5
            });
        }

        function drawNeuralNetwork() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw connections
            ctx.strokeStyle = 'rgba(139, 92, 246, 0.1)';
            ctx.lineWidth = 0.5;
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < nodes.length; j++) {
                    const dx = nodes[i].x - nodes[j].x;
                    const dy = nodes[i].y - nodes[j].y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < 150) {
                        ctx.beginPath();
                        ctx.moveTo(nodes[i].x, nodes[i].y);
                        ctx.lineTo(nodes[j].x, nodes[j].y);
                        ctx.stroke();
                    }
                }
            }

            // Draw nodes
            ctx.fillStyle = 'rgba(139, 92, 246, 0.3)';
            nodes.forEach(node => {
                ctx.beginPath();
                ctx.arc(node.x, node.y, 2, 0, Math.PI * 2);
                ctx.fill();

                // Update position
                node.x += node.vx;
                node.y += node.vy;

                // Bounce off edges
                if (node.x < 0 || node.x > canvas.width) node.vx *= -1;
                if (node.y < 0 || node.y > canvas.height) node.vy *= -1;
            });

            requestAnimationFrame(drawNeuralNetwork);
        }

        drawNeuralNetwork();

        // Sidebar & Navigation Logic
        function scrollToSection(id) {
            const element = document.getElementById(id);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Update active state in sidebar
                document.querySelectorAll('.sidebar-icon').forEach(icon => {
                    if (icon.getAttribute('onclick') && icon.getAttribute('onclick').includes(id)) {
                        document.querySelectorAll('.sidebar-icon').forEach(i => i.classList.remove('active'));
                        icon.classList.add('active');
                    }
                });

                showToast({ type: 'info', event: `Navigating to ${id.charAt(0).toUpperCase() + id.slice(1)} Monitoring` });
            }
        }

        function logout() {
            showToast({ type: 'warning', event: 'Ending Secure Session...' });
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 1000);
        }

        function openSettings() {
            showToast({ type: 'info', event: 'Initializing System Configuration Modal' });
            // In a real app, this would open a glassmorphism modal
            alert("System Settings: \n- AI Sensitivity: High\n- Telemetry Frequency: 50ms\n- Security Protocol: SRMAP-V2");
        }

        // Current Time Update
        function updateTime() {
            const now = new Date();
            const timeEl = document.getElementById('currentTime');
            if (timeEl) {
                timeEl.textContent = now.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
            }
        }

        // --- Live Telemetry Integration ---

        async function updateCampusTelemetry() {
            try {
                const response = await fetch(`${API_BASE}/telemetry`);
                const data = await response.json();

                // 1. Mess Crowd Index
                if (data.mess_crowd_index) {
                    const bar = document.getElementById('messCrowdBar');
                    if (bar) bar.style.width = `${data.mess_crowd_index.value}%`;
                }

                // 2. Water Reserve
                if (data.water_reserve) {
                    const el = document.getElementById('waterReserve');
                    if (el) el.innerHTML = `${(parseFloat(data.water_reserve.value) / 1000).toFixed(1)}k <span class="text-[10px] font-normal text-gray-500">L</span>`;
                }

                // 3. Energy Saving
                if (data.energy_saving) {
                    const el = document.getElementById('energySaving');
                    if (el) el.textContent = `+${data.energy_saving.value}%`;
                }

                // 4. Shuttle ETA
                if (data.shuttle_eta) {
                    const el = document.getElementById('shuttleETA');
                    if (el) el.textContent = data.shuttle_eta.value;
                }

                // 5. Solar Energy
                if (data.solar_contribution) {
                    const el = document.getElementById('solarContribution');
                    if (el) el.textContent = data.solar_contribution.value;
                }

                // 6. Power Draw
                if (data.power_draw) {
                    const el = document.getElementById('powerDraw');
                    if (el) el.textContent = data.power_draw.value;
                }

                // Simulate drift on backend for next poll
                Object.keys(data).forEach(key => {
                    fetch(`${API_BASE}/telemetry/update`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ key })
                    });
                });

            } catch (error) {
                console.error("Telemetry Sync Failed:", error);
            }
        }

        // Initialize Live Systems
        setInterval(updateTime, 1000);
        setInterval(updateCampusTelemetry, 3000); // Poll every 3 seconds
        updateTime();
        updateCampusTelemetry();

        // School Switching Logic
        function switchSchool(school) {
            document.querySelectorAll('.school-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Re-generate heatmap with "school-specific" mock data mapping
            generateHeatmap();

            showToast({ type: 'info', event: `Switched view to ${school} Campus Block` });
        }

        // Campus Zones Data (stored for reference)
        let zones = [];

        // Generate Heatmap
        async function generateHeatmap() {
            try {
                const response = await fetch(`${API_BASE}/occupancy/current`);
                const data = await response.json();

                zones = data;

                const grid = document.getElementById('heatmapGrid');
                grid.innerHTML = '';

                zones.forEach((zone, index) => {
                    const occupancy = Math.round(zone.utilization * 100);
                    let color, glowColor;

                    if (occupancy <= 30) {
                        color = 'bg-green-500';
                        glowColor = 'rgba(34, 197, 94, 0.5)';
                    } else if (occupancy <= 70) {
                        color = 'bg-yellow-500';
                        glowColor = 'rgba(234, 179, 8, 0.5)';
                    } else if (occupancy <= 90) {
                        color = 'bg-orange-500';
                        glowColor = 'rgba(249, 115, 22, 0.5)';
                    } else {
                        color = 'bg-red-500';
                        glowColor = 'rgba(239, 68, 68, 0.8)';
                    }

                    const cell = document.createElement('div');
                    cell.className = `heatmap-cell ${color} rounded-lg aspect-square relative group cursor-pointer`;
                    cell.style.boxShadow = `0 0 20px ${glowColor}`;

                    cell.innerHTML = `
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                            <div class="text-center p-2 bg-black/80 rounded-lg backdrop-blur-sm">
                                <div class="text-[9px] font-bold text-violet-400 uppercase mb-1">Block ${Math.floor(index / 8) + 1}</div>
                                <div class="text-xs font-bold mono">RM-${100 + index}</div>
                                <div class="text-xl font-bold">${occupancy}%</div>
                            </div>
                        </div>
                    `;

                    grid.appendChild(cell);
                });

                // Update active zones count (derived)
                const activeZones = zones.filter(z => z.current_count > 0).length;
                animateNumber('activeZones', activeZones);

            } catch (error) {
                console.error('Error fetching occupancy data:', error);
            }
        }

        // Animate Number
        function animateNumber(elementId, target) {
            const element = document.getElementById(elementId);
            if (!element) return;
            let current = parseFloat(element.textContent) || 0;
            const diff = target - current;
            const increment = diff / 20;
            let steps = 0;

            const timer = setInterval(() => {
                current += increment;
                steps++;
                if (steps >= 20) {
                    element.textContent = Math.round(target);
                    clearInterval(timer);
                } else {
                    element.textContent = Math.round(current);
                }
            }, 30);
        }

        // Predictive Load
        async function updatePredictiveLoad() {
            try {
                const response = await fetch(`${API_BASE}/predictions/next`);
                const data = await response.json();

                if (data.length === 0) return;

                // Calculate average predicted utilization
                const totalPred = data.reduce((sum, p) => sum + p.predicted_count, 0);
                const totalCap = data.reduce((sum, p) => sum + p.capacity, 0);
                const load = Math.round((totalPred / totalCap) * 100);

                animateNumber('predictiveLoad', load);

                const circle = document.getElementById('predictiveCircle');
                const circumference = 2 * Math.PI * 80;
                const offset = circumference - (circumference * load / 100);
                circle.style.strokeDasharray = circumference;
                circle.style.strokeDashoffset = offset;

                // Get next hour
                const peakTime = new Date(data[0].prediction_time);
                document.getElementById('peakTime').textContent = peakTime.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });

                // Update status
                const status = load > 85 ? 'CRITICAL' : load > 70 ? 'WARNING' : 'OPTIMAL';
                const statusEl = document.getElementById('forecastStatus');
                statusEl.textContent = status;
                statusEl.className = `text-[10px] mono tracking-widest font-bold ${load > 85 ? 'text-red-400' : load > 70 ? 'text-yellow-400' : 'text-green-400'}`;

            } catch (error) {
                console.error('Error fetching predictive load:', error);
            }
        }

        // Action Feed
        async function updateActionFeed() {
            try {
                const response = await fetch(`${API_BASE}/resource/history`);
                const data = await response.json();

                const feed = document.getElementById('actionFeed');
                const currentActions = feed.querySelectorAll('.glass-card').length;

                if (data.length === 0) return;

                // Only add if there are new actions
                const lastFive = data.slice(0, 5);
                feed.innerHTML = '';

                lastFive.forEach(action => {
                    const actionEl = document.createElement('div');
                    actionEl.className = 'glass-card p-3 text-sm border-l-2 border-cyan-500';

                    const time = new Date(action.timestamp).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });

                    actionEl.innerHTML = `
                        <div class="flex items-start gap-3">
                            <div class="w-2 h-2 rounded-full bg-cyan-500 mt-1.5 flex-shrink-0"></div>
                            <div class="flex-1">
                                <div class="font-bold text-white">${action.event_name}</div>
                                <div class="text-[10px] text-gray-400 mono mt-1">${time}</div>
                                <div class="mt-2 text-gray-300 flex items-center gap-2">
                                    <span class="font-mono text-[10px] bg-red-500/20 px-2 py-0.5 rounded text-red-400">${action.from_space}</span>
                                    <span class="text-gray-600"></span>
                                    <span class="font-mono text-[10px] bg-green-500/20 px-2 py-0.5 rounded text-green-400">${action.to_space}</span>
                                </div>
                                <div class="text-[11px] text-gray-400 mt-2 italic">${action.reason}</div>
                            </div>
                        </div>
                    `;
                    feed.appendChild(actionEl);
                });

                if (data.length > currentActions && currentActions > 0) {
                    showToast({ type: 'reassign', event: data[0].event_name });
                }

            } catch (error) {
                console.error('Error fetching action feed:', error);
            }
        }

        // Toast Notification
        function showToast(action) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'glass-card p-4 toast flex items-center gap-3 min-w-[300px] pointer-events-auto';

            let icon, color;
            if (action.type === 'reassign') {
                icon = '';
                color = 'text-cyan-400';
            } else {
                icon = '';
                color = 'text-yellow-400';
            }

            toast.innerHTML = `
                <div class="text-2xl">${icon}</div>
                <div class="flex-1">
                    <div class="font-semibold ${color}">System Action</div>
                    <div class="text-xs text-gray-400 mt-1">${action.event}</div>
                </div>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(400px)';
                setTimeout(() => toast.remove(), 400);
            }, 4000);
        }

        // Learning Log
        async function updateLearningLog() {
            try {
                const response = await fetch(`${API_BASE}/feedback/metrics`);
                const data = await response.json();

                const log = document.getElementById('learningLog');
                log.innerHTML = '';

                if (data.length === 0) {
                    log.innerHTML = '<div class="text-center py-4 text-gray-500 text-xs italic">Gathering data samples...</div>';
                    return;
                }

                data.forEach(metric => {
                    const entry = document.createElement('div');
                    entry.className = 'glass-card p-3 text-sm';
                    const accuracy = Math.round(100 - (metric.avg_error || 0));

                    entry.innerHTML = `
                        <div class="flex items-start gap-2">
                            <div class="w-1.5 h-1.5 rounded-full bg-gradient-to-r from-violet-500 to-cyan-500 mt-1.5 flex-shrink-0"></div>
                            <div class="flex-1">
                                <div class="flex justify-between items-center mb-1">
                                    <div class="font-semibold text-gray-300 text-xs">${metric.name}</div>
                                    <div class="text-[10px] text-cyan-400 mono">${accuracy}% Acc.</div>
                                </div>
                                <div class="w-full bg-white/5 h-1 rounded-full overflow-hidden">
                                    <div class="bg-gradient-to-r from-violet-500 to-cyan-500 h-full transition-all duration-500" style="width: ${accuracy}%"></div>
                                </div>
                                <div class="text-[9px] text-gray-500 mt-1 italic">Based on ${metric.sample_size} datasets</div>
                            </div>
                        </div>
                    `;
                    log.appendChild(entry);
                });

            } catch (error) {
                console.error('Error fetching learning log:', error);
            }
        }

        // Efficiency Score
        async function updateEfficiencyScore() {
            try {
                const response = await fetch(`${API_BASE}/occupancy/current`);
                const data = await response.json();

                if (data.length === 0) return;

                // Better distribution = higher efficiency
                const utils = data.map(z => z.utilization);
                const mean = utils.reduce((a, b) => a + b, 0) / utils.length;
                const variance = utils.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / utils.length;

                const score = Math.round(Math.max(0, (1 - variance) * 100));

                animateNumber('efficiencyScore', score);

                const circle = document.getElementById('efficiencyCircle');
                const circumference = 2 * Math.PI * 70;
                const offset = circumference - (circumference * score / 100);
                circle.style.strokeDasharray = circumference;
                circle.style.strokeDashoffset = offset;

            } catch (error) {
                console.error('Error fetching efficiency score:', error);
            }
        }

        // Initialize
        function init() {
            generateHeatmap();
            updatePredictiveLoad();
            updateEfficiencyScore();
            updateActionFeed();
            updateLearningLog();
        }

        init();

        // Update intervals
        setInterval(generateHeatmap, 5000);
        setInterval(updatePredictiveLoad, 8000);
        setInterval(updateActionFeed, 10000);
        setInterval(updateLearningLog, 15000);
        setInterval(updateEfficiencyScore, 20000);

        // Resize handler
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>

</html>